(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const r={controls:{fileInput:document.getElementById("file-input"),uploadButton:document.getElementById("upload-button"),gotoLoopStart:document.getElementById("goto-loop-start"),playButton:document.getElementById("play-button"),pauseButton:document.getElementById("pause-button"),stopButton:document.getElementById("stop-button"),loopButton:document.getElementById("loop-button")},progress:{seekBar:document.getElementById("fill-container"),progressFill:document.getElementById("progress-fill")},fileStatus:{fileName:document.querySelector("#file-status .file-name"),fileDuration:document.querySelector("#file-status .file-duration")},playTime:{currentTimeDisplay:document.getElementById("progress-time")},indicators:{playIndicator:document.getElementById("playIndicator"),pauseIndicator:document.getElementById("pauseIndicator"),loopIndicator:document.getElementById("loopIndicator"),pitchIndicator:document.getElementById("pitchIndicator"),metroIndicator:document.getElementById("metroIndicator"),timerIndicator:document.getElementById("timerIndicator"),tunerIndicator:document.getElementById("tunerIndicator"),forkIndicator:document.getElementById("forkIndicator")},pitchControls:{transposeWheel:document.getElementById("transpose-wheel"),tuneWheel:document.getElementById("tune-wheel"),tempoWheel:document.getElementById("tempo-wheel"),transposeValue:document.querySelector("#transpose-wheel .active-value"),tuneValue:document.querySelector("#tune-wheel .active-value"),tempoValue:document.querySelector("#tempo-wheel .active-value"),transposeSign:document.querySelector("#transpose-wheel .sign-indicator"),tuneSign:document.querySelector("#tune-wheel .sign-indicator")},timer:{modeBtn:document.getElementById("modeBtn"),startStopBtn:document.getElementById("startStopBtn"),resetBtn:document.getElementById("resetBtn"),timerDisplay:document.getElementById("timer-display"),timerDigits:document.getElementById("timer-digits"),stopwatchLed:document.getElementById("stopwatch-led"),timerLed:document.getElementById("timer-led"),partEls:document.querySelectorAll(".time-part")},loopInputs:{start:{mins:document.getElementById("loop-start-mins"),secs:document.getElementById("loop-start-secs"),hund:document.getElementById("loop-start-hund")},end:{mins:document.getElementById("loop-end-mins"),secs:document.getElementById("loop-end-secs"),hund:document.getElementById("loop-end-hund")}},loopDisp:{loopStartDisp:document.getElementById("loop-start-input"),loopEndDisp:document.getElementById("loop-end-input")},loopMarkers:{loopStartMarker:document.getElementById("loop-start-marker"),loopEndMarker:document.getElementById("loop-end-marker")},fork:{display:document.getElementById("tuning-fork-display"),note:document.querySelector("#fork-note"),freq:document.querySelector("#fork-freq"),placeholder:document.querySelector("#fork-note-placeholder")},metro:{display:document.getElementById("metronome-display"),tempo:document.querySelector("#metronome-display .tempo"),signature:document.querySelector("#metronome-time-signature"),tap:document.getElementById("metronome-tap")},tuner:{display:document.getElementById("tuner-display"),note:document.getElementById("tuner-note"),placeholder:document.getElementById("tuner-note-placeholder"),chevronsFlat:document.querySelectorAll("#tuner-chevron-display .chev.flat"),chevronsSharp:document.querySelectorAll("#tuner-chevron-display .chev.sharp"),chevronCenter:document.querySelector("#tuner-chevron-display .chev.center")},viewer:{focusBtn:document.getElementById("focus-mode")}};class $t{constructor({audioCtx:e,bpm:t=120,timeSig:s=[4,4],downbeatURL:o="/sounds/metro_click01.wav",beatURL:a="/sounds/metro_click02.wav",displayEl:l=null}={}){this.audioCtx=e||new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioCtx.createGain(),this.masterGain.gain.value=.75,this.masterGain.connect(this.audioCtx.destination),this.lookAhead=.025,this.scheduleHorizon=.1,this.nextNoteTime=0,this.isRunning=!1,this.bpm=t,this.timeSig=s,this.currentBeat=0,this.timerID=null,this.displayEl=l,this.downbeatBuf=null,this.beatBuf=null,Promise.all([this._loadBuffer(o),this._loadBuffer(a)]).then(([i,d])=>{this.downbeatBuf=i,this.beatBuf=d,this.displayEl&&(this.displayEl.textContent=`${this.bpm}`)})}static init(e={}){const t=new $t(e);return e.displayEl&&e.displayEl.addEventListener("click",()=>t.toggle()),e.bpmInput&&e.bpmInput.addEventListener("input",s=>t.setBpm(+s.target.value)),e.sigSelect&&e.sigSelect.addEventListener("change",s=>t.setTimeSignature(s.target.value)),t}start(){this.isRunning||(this.isRunning=!0,this.currentBeat=0,this.nextNoteTime=this.audioCtx.currentTime+.05,this._scheduler(),this.timerID=setInterval(()=>this._scheduler(),this.lookAhead*1e3),this._updateDisplayActive(!0))}stop(){this.isRunning&&(this.isRunning=!1,clearInterval(this.timerID),this._updateDisplayActive(!1))}toggle(){this.isRunning?this.stop():this.start()}setBpm(e){this.bpm=Math.min(400,Math.max(60,e)),this.displayEl&&(this.displayEl.textContent=`${this.bpm}`)}setTimeSignature(e){if(typeof e=="string"){const[t,s]=e.split("/").map(Number);this.timeSig=[t,s]}else Array.isArray(e)&&(this.timeSig=e)}async _loadBuffer(e){const s=await(await fetch(e)).arrayBuffer();return await this.audioCtx.decodeAudioData(s)}_scheduler(){for(;this.nextNoteTime<this.audioCtx.currentTime+this.scheduleHorizon;)this._scheduleClick(this.currentBeat,this.nextNoteTime),this._advanceNote()}_advanceNote(){const e=60/this.bpm;this.nextNoteTime+=e,this.currentBeat=(this.currentBeat+1)%this.timeSig[0]}setVolume(e){this.masterGain.gain.value=Math.max(0,Math.min(1,e))}_scheduleClick(e,t){const s=this.audioCtx.createBufferSource();s.buffer=e===0?this.downbeatBuf:this.beatBuf;const o=this.audioCtx.createGain();if(o.gain.value=e===0?1:.6,s.connect(o).connect(this.masterGain),s.start(t),this.displayEl){const a=new CustomEvent("metronomeTick",{detail:{beat:e,time:t}});this.displayEl.dispatchEvent(a)}}_updateDisplayActive(e){this.displayEl&&this.displayEl.classList.toggle("active",e)}}const H=r.metro.display,We=r.metro.tempo,He=r.metro.signature,Re=r.metro.tap,Xe=r.indicators.metroIndicator,Jt=40,Ot=400,Ze=n=>n<100?`<span style="visibility:hidden">0</span>${n}`:`${n}`,jt=document.createElement("div");Object.assign(jt.style,{position:"absolute",opacity:"0",pointerEvents:"none",width:H.offsetWidth+"px",height:H.offsetHeight+"px"});const tt=H.cloneNode(!0);jt.appendChild(tt);H.parentNode.insertBefore(jt,H);const R=$t.init({displayEl:tt,tempoDisplayEl:tt.querySelector(".tempo"),sigSelect:He});window.metroInstance=R;function At(){We.innerHTML=Ze(R.bpm),H.classList.toggle("active",tt.classList.contains("active")),Xe.classList.toggle("indicated",R.isPlaying)}new MutationObserver(At).observe(tt,{attributes:!0,subtree:!0,childList:!0,characterData:!0});At();Object.defineProperty(R,"isPlaying",{get:()=>tt.classList.contains("active")});H.addEventListener("click",()=>tt.click());const Z=[],ze=8,Ye=2e3;Re.addEventListener("click",()=>{const n=performance.now();if(Z.length&&n-Z[Z.length-1]>Ye&&(Z.length=0),Z.push(n),Z.length>ze&&Z.shift(),Z.length>=2){const t=Z.slice(1).map((s,o)=>s-Z[o]).filter(s=>{const o=6e4/s;return o>=Jt&&o<=Ot});if(t.length){t.sort((l,i)=>l-i);const s=Math.floor(t.length/2),o=t.length%2===0?(t[s-1]+t[s])/2:t[s],a=Math.round(6e4/o);R.setBpm(a),At()}}});H.addEventListener("wheel",n=>{n.preventDefault();const e=-n.deltaY*.01;let t=Math.round(R.bpm+e);t=Math.min(Ot,Math.max(Jt,t)),R.setBpm(t),At()},{passive:!1});requestAnimationFrame(()=>{let n=null,e=0;const t=.05,s=()=>{n=null,e=0};H.addEventListener("touchstart",o=>{o.touches.length===1&&(n=o.touches[0].clientY,e=0)},{passive:!1}),H.addEventListener("touchmove",o=>{if(o.touches.length!==1||n===null)return;const a=o.touches[0].clientY,l=n-a;e+=l,n=a;const i=e*t;if(Math.abs(i)>=1){let d=Math.round(R.bpm+i);d=Math.min(Ot,Math.max(Jt,d)),R.setBpm(d),At(),e=0}o.preventDefault()},{passive:!1}),H.addEventListener("touchend",s)});const{modeBtn:Pe,startStopBtn:te,resetBtn:qe,timerDisplay:me,stopwatchLed:re,timerLed:ie,partEls:it}=r.timer;let lt=!0,Dt=0,N=6e4,ct=!1,Ft=null;const Qt=new Audio("/sounds/timer_beep.wav");Qt.volume=.7;function pe(n){const e=Math.floor(n/10),t=e%100,s=Math.floor(e/100),o=s%60;return{min:Math.floor(s/60),sec:o,hun:t}}function ee({min:n,sec:e,hun:t}){return((n*60+e)*100+t)*10}function dt(n){const{min:e,sec:t,hun:s}=pe(n);it.forEach(o=>{switch(o.dataset.unit){case"min":o.value=String(e).padStart(2,"0");break;case"sec":o.value=String(t).padStart(2,"0");break;case"hun":o.value=String(s).padStart(2,"0");break}})}function Qe(n,e){if(ct)return;const t=pe(N);if(n==="min"&&(t.min=Math.max(0,t.min+e)),n==="sec"){for(t.sec+=e;t.sec<0;)t.min?(t.min--,t.sec+=60):t.sec=0;for(;t.sec>=60;)t.min++,t.sec-=60}if(n==="hun"){for(t.hun+=e;t.hun<0;)t.sec||t.min?(t.sec?t.sec--:(t.min--,t.sec=59),t.hun+=100):t.hun=0;for(;t.hun>=100;)t.sec++,t.hun-=100;t.sec>=60&&(t.min+=Math.floor(t.sec/60),t.sec%=60)}N=ee(t),dt(N)}it.forEach(n=>{n.addEventListener("wheel",e=>{e.preventDefault();const t=-Math.sign(e.deltaY);Qe(n.dataset.unit,t)})});let ne=0;function Ut(){const e=Date.now()-Dt;if(lt){const t=Math.max(N-e,0);dt(t),t>0?Ft=requestAnimationFrame(Ut):Nt()}else dt(ne+e),Ft=requestAnimationFrame(Ut)}function Ue(){ct||(ct=!0,Dt=Date.now(),Ft=requestAnimationFrame(Ut),me.classList.add("active"),te.classList.add("active"),r.indicators.timerIndicator.classList.add("indicated"))}function Nt(){if(ct){if(ct=!1,cancelAnimationFrame(Ft),lt){const n=Date.now()-Dt;N=Math.max(N-n,0),N===0&&(Qt.currentTime=0,Qt.play())}else ne+=Date.now()-Dt;me.classList.remove("active"),te.classList.remove("active"),r.indicators.timerIndicator.classList.remove("indicated")}}function he(){Nt(),lt?(N=6e4,dt(N)):(ne=0,dt(0))}function fe(){lt?(ie.classList.add("active"),re.classList.remove("active")):(re.classList.add("active"),ie.classList.remove("active"))}fe();Pe.addEventListener("click",()=>{Nt(),lt=!lt,fe(),he()});te.addEventListener("click",()=>ct?Nt():Ue());qe.addEventListener("click",()=>{he()});dt(N);it.forEach(n=>{n.tabIndex=0,n.dataset.caret=0,n.addEventListener("focus",()=>{n.dataset.caret=0}),n.addEventListener("keydown",e=>{if(!/^\d$/.test(e.key)){e.preventDefault();return}const s=e.key,o=parseInt(n.dataset.caret,10);let a=n.value.padStart(2,"0");if(o===0?n.value=s+a[1]:n.value=a[0]+s,n.dataset.caret=(o+1)%2,e.preventDefault(),n.dataset.caret==="0"){const i=n.nextElementSibling;i&&i.classList.contains("time-part")&&(i.focus(),i.dataset.caret=0)}const l={};it.forEach(i=>{l[i.dataset.unit]=parseInt(i.value,10)}),N=ee(l)})});it.forEach(n=>{n.addEventListener("input",()=>{let e=n.value.replace(/\D/g,"").slice(0,2);n.value=e.padStart(2,"0");const t={};it.forEach(s=>{t[s.dataset.unit]=parseInt(s.value,10)}),N=ee(t)})});function Ke(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var zt,le;function $e(){if(le)return zt;le=1;function n(e){if(this.size=e|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(this.size*2),s=0;s<t.length;s+=2){const f=Math.PI*s/this.size;t[s]=Math.cos(f),t[s+1]=-Math.sin(f)}this.table=t;for(var o=0,a=1;this.size>a;a<<=1)o++;this._width=o%2===0?o-1:o,this._bitrev=new Array(1<<this._width);for(var l=0;l<this._bitrev.length;l++){this._bitrev[l]=0;for(var i=0;i<this._width;i+=2){var d=this._width-i-2;this._bitrev[l]|=(l>>>i&3)<<d}}this._out=null,this._data=null,this._inv=0}return zt=n,n.prototype.fromComplexArray=function(t,s){for(var o=s||new Array(t.length>>>1),a=0;a<t.length;a+=2)o[a>>>1]=t[a];return o},n.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var s=0;s<t.length;s++)t[s]=0;return t},n.prototype.toComplexArray=function(t,s){for(var o=s||this.createComplexArray(),a=0;a<o.length;a+=2)o[a]=t[a>>>1],o[a+1]=0;return o},n.prototype.completeSpectrum=function(t){for(var s=this._csize,o=s>>>1,a=2;a<o;a+=2)t[s-a]=t[a],t[s-a+1]=-t[a+1]},n.prototype.transform=function(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=0,this._transform4(),this._out=null,this._data=null},n.prototype.realTransform=function(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=0,this._realTransform4(),this._out=null,this._data=null},n.prototype.inverseTransform=function(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=1,this._transform4();for(var o=0;o<t.length;o++)t[o]/=this.size;this._out=null,this._data=null},n.prototype._transform4=function(){var t=this._out,s=this._csize,o=this._width,a=1<<o,l=s/a<<1,i,d,f=this._bitrev;if(l===4)for(i=0,d=0;i<s;i+=l,d++){const I=f[d];this._singleTransform2(i,I,a)}else for(i=0,d=0;i<s;i+=l,d++){const I=f[d];this._singleTransform4(i,I,a)}var h=this._inv?-1:1,g=this.table;for(a>>=2;a>=2;a>>=2){l=s/a<<1;var E=l>>>2;for(i=0;i<s;i+=l)for(var b=i+E,w=i,B=0;w<b;w+=2,B+=a){const I=w,C=I+E,A=C+E,c=A+E,u=t[I],m=t[I+1],p=t[C],y=t[C+1],_=t[A],T=t[A+1],k=t[c],V=t[c+1],G=u,L=m,D=g[B],W=h*g[B+1],F=p*D-y*W,X=p*W+y*D,Q=g[2*B],q=h*g[2*B+1],U=_*Q-T*q,K=_*q+T*Q,ht=g[3*B],ft=h*g[3*B+1],vt=k*ht-V*ft,gt=k*ft+V*ht,yt=G+U,st=L+K,ot=G-U,It=L-K,bt=F+vt,at=X+gt,rt=h*(F-vt),Bt=h*(X-gt),St=yt+bt,kt=st+at,Vt=yt-bt,Gt=st-at,Wt=ot+Bt,Ht=It-rt,Rt=ot-Bt,Xt=It+rt;t[I]=St,t[I+1]=kt,t[C]=Wt,t[C+1]=Ht,t[A]=Vt,t[A+1]=Gt,t[c]=Rt,t[c+1]=Xt}}},n.prototype._singleTransform2=function(t,s,o){const a=this._out,l=this._data,i=l[s],d=l[s+1],f=l[s+o],h=l[s+o+1],g=i+f,E=d+h,b=i-f,w=d-h;a[t]=g,a[t+1]=E,a[t+2]=b,a[t+3]=w},n.prototype._singleTransform4=function(t,s,o){const a=this._out,l=this._data,i=this._inv?-1:1,d=o*2,f=o*3,h=l[s],g=l[s+1],E=l[s+o],b=l[s+o+1],w=l[s+d],B=l[s+d+1],I=l[s+f],C=l[s+f+1],A=h+w,c=g+B,u=h-w,m=g-B,p=E+I,y=b+C,_=i*(E-I),T=i*(b-C),k=A+p,V=c+y,G=u+T,L=m-_,D=A-p,W=c-y,F=u-T,X=m+_;a[t]=k,a[t+1]=V,a[t+2]=G,a[t+3]=L,a[t+4]=D,a[t+5]=W,a[t+6]=F,a[t+7]=X},n.prototype._realTransform4=function(){var t=this._out,s=this._csize,o=this._width,a=1<<o,l=s/a<<1,i,d,f=this._bitrev;if(l===4)for(i=0,d=0;i<s;i+=l,d++){const Zt=f[d];this._singleRealTransform2(i,Zt>>>1,a>>>1)}else for(i=0,d=0;i<s;i+=l,d++){const Zt=f[d];this._singleRealTransform4(i,Zt>>>1,a>>>1)}var h=this._inv?-1:1,g=this.table;for(a>>=2;a>=2;a>>=2){l=s/a<<1;var E=l>>>1,b=E>>>1,w=b>>>1;for(i=0;i<s;i+=l)for(var B=0,I=0;B<=w;B+=2,I+=a){var C=i+B,A=C+b,c=A+b,u=c+b,m=t[C],p=t[C+1],y=t[A],_=t[A+1],T=t[c],k=t[c+1],V=t[u],G=t[u+1],L=m,D=p,W=g[I],F=h*g[I+1],X=y*W-_*F,Q=y*F+_*W,q=g[2*I],U=h*g[2*I+1],K=T*q-k*U,ht=T*U+k*q,ft=g[3*I],vt=h*g[3*I+1],gt=V*ft-G*vt,yt=V*vt+G*ft,st=L+K,ot=D+ht,It=L-K,bt=D-ht,at=X+gt,rt=Q+yt,Bt=h*(X-gt),St=h*(Q-yt),kt=st+at,Vt=ot+rt,Gt=It+St,Wt=bt-Bt;if(t[C]=kt,t[C+1]=Vt,t[A]=Gt,t[A+1]=Wt,B===0){var Ht=st-at,Rt=ot-rt;t[c]=Ht,t[c+1]=Rt;continue}if(B!==w){var Xt=It,Se=-bt,Me=st,Te=-ot,_e=-h*St,De=-h*Bt,Fe=-h*rt,xe=-h*at,Ne=Xt+_e,ke=Se+De,Ve=Me+xe,Ge=Te-Fe,oe=i+b-B,ae=i+E-B;t[oe]=Ne,t[oe+1]=ke,t[ae]=Ve,t[ae+1]=Ge}}}},n.prototype._singleRealTransform2=function(t,s,o){const a=this._out,l=this._data,i=l[s],d=l[s+o],f=i+d,h=i-d;a[t]=f,a[t+1]=0,a[t+2]=h,a[t+3]=0},n.prototype._singleRealTransform4=function(t,s,o){const a=this._out,l=this._data,i=this._inv?-1:1,d=o*2,f=o*3,h=l[s],g=l[s+o],E=l[s+d],b=l[s+f],w=h+E,B=h-E,I=g+b,C=i*(g-b),A=w+I,c=B,u=-C,m=w-I,p=B,y=C;a[t]=A,a[t+1]=0,a[t+2]=c,a[t+3]=u,a[t+4]=m,a[t+5]=0,a[t+6]=p,a[t+7]=y},zt}var Je=$e();const Oe=Ke(Je);class Ct{_inputLength;_fft;_bufferSupplier;_paddedInputBuffer;_transformBuffer;_inverseBuffer;static forFloat32Array(e){return new Ct(e,t=>new Float32Array(t))}static forFloat64Array(e){return new Ct(e,t=>new Float64Array(t))}static forNumberArray(e){return new Ct(e,t=>Array(t))}constructor(e,t){if(e<1)throw new Error("Input length must be at least one");this._inputLength=e,this._fft=new Oe(en(2*e)),this._bufferSupplier=t,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}get inputLength(){return this._inputLength}autocorrelate(e,t=this._bufferSupplier(e.length)){if(e.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${e.length}`);for(let o=0;o<e.length;o++)this._paddedInputBuffer[o]=e[o];for(let o=e.length;o<this._paddedInputBuffer.length;o++)this._paddedInputBuffer[o]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const s=this._transformBuffer;for(let o=0;o<s.length;o+=2)s[o]=s[o]*s[o]+s[o+1]*s[o+1],s[o+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let o=0;o<e.length;o++)t[o]=this._inverseBuffer[2*o];return t}}function je(n){const e=[];let t=!1,s=-1/0,o=-1;for(let a=1;a<n.length-1;a++)n[a-1]<=0&&n[a]>0?(t=!0,o=a,s=n[a]):n[a-1]>0&&n[a]<=0?(t=!1,o!==-1&&e.push(o)):t&&n[a]>s&&(s=n[a],o=a);return e}function tn(n,e){const[t,s,o]=[n-1,n,n+1],[a,l,i]=[e[t],e[s],e[o]],d=a/2-l+i/2,f=-(a/2)*(s+o)+l*(t+o)-i/2*(t+s),h=a*s*o/2-l*t*o+i*t*s/2,g=-f/(2*d),E=d*g*g+f*g+h;return[g,E]}class Lt{_autocorrelator;_nsdfBuffer;_clarityThreshold=.9;_minVolumeAbsolute=0;_maxInputAmplitude=1;static forFloat32Array(e){return new Lt(e,t=>new Float32Array(t))}static forFloat64Array(e){return new Lt(e,t=>new Float64Array(t))}static forNumberArray(e){return new Lt(e,t=>Array(t))}constructor(e,t){this._autocorrelator=new Ct(e,t),this._nsdfBuffer=t(e)}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(e){if(!Number.isFinite(e)||e<=0||e>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=e}set minVolumeAbsolute(e){if(!Number.isFinite(e)||e<0||e>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=e}set minVolumeDecibels(e){if(!Number.isFinite(e)||e>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(e/10)}set maxInputAmplitude(e){if(!Number.isFinite(e)||e<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=e}findPitch(e,t){if(this._belowMinimumVolume(e))return[0,0];this._nsdf(e);const s=je(this._nsdfBuffer);if(s.length===0)return[0,0];const o=Math.max(...s.map(d=>this._nsdfBuffer[d])),a=s.find(d=>this._nsdfBuffer[d]>=this._clarityThreshold*o),[l,i]=tn(a,this._nsdfBuffer);return[t/l,Math.min(i,1)]}_belowMinimumVolume(e){if(this._minVolumeAbsolute===0)return!1;let t=0;for(let s=0;s<e.length;s++)t+=e[s]**2;return Math.sqrt(t/e.length)<this._minVolumeAbsolute}_nsdf(e){this._autocorrelator.autocorrelate(e,this._nsdfBuffer);let t=2*this._nsdfBuffer[0],s;for(s=0;s<this._nsdfBuffer.length&&t>0;s++)this._nsdfBuffer[s]=2*this._nsdfBuffer[s]/t,t-=e[s]**2+e[e.length-s-1]**2;for(;s<this._nsdfBuffer.length;s++)this._nsdfBuffer[s]=0}}function en(n){return n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n++,n}let z,Y,wt,ve,Mt,et=!1;const nn=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"];window.addEventListener("audioInputChanged",n=>{const e=n.detail.deviceId;et&&Ie(),ye(e)});function sn(n){if(!n)return null;const e=440,t=12,s=Math.round(t*Math.log2(n/e))+69,o=s%t,a=Math.floor(s/t)-1,l=nn[o],i=e*2**((s-69)/t),d=1200*Math.log2(n/i);return{noteName:l,octave:a,centsDiff:d}}function on(n,e){const t=n.includes("♯");let s="";t?s=`${n[0]}<span class="tuner-sharp">♯</span>${e}`:s=`${n}<span class="invisible-tuner-sharp">♯</span>${e}`,r.tuner.note.innerHTML=s}function an(n){const e=r.tuner.chevronsFlat,t=r.tuner.chevronsSharp,s=r.tuner.chevronCenter;e.forEach(l=>l.style.opacity="0.05"),t.forEach(l=>l.style.opacity="0.05"),s.style.opacity="0.05";const o=Math.abs(n);if(o<=5){s.style.opacity="1";return}if(o<=10){s.style.opacity="1",n<0?e.forEach(l=>l.style.opacity="1"):t.forEach(l=>l.style.opacity="1");return}let a=0;if(o<=15?a=3:o<=30?a=2:o<=50?a=1:a=0,a!==0)if(n<0)for(let l=0;l<a;l++)e[l].style.opacity="1";else for(let l=0;l<a;l++)t[t.length-1-l].style.opacity="1"}async function ge(){if(!et)return;const e=Y.fftSize,t=new Float32Array(e);Y.getFloatTimeDomainData(t);let s=0;for(let i=0;i<t.length;i++)s+=t[i]*t[i];const o=Math.sqrt(s/t.length),[a,l]=ve.findPitch(t,z.sampleRate);if(o>.01&&l>.8&&a){const i=sn(a);i&&(on(i.noteName,i.octave),an(i.centsDiff))}else r.tuner.note.innerHTML='-<span class="invisible-tuner-sharp">♯</span>-',r.tuner.chevronCenter.style.opacity="0.05",r.tuner.chevronsFlat.forEach(i=>i.style.opacity="0.05"),r.tuner.chevronsSharp.forEach(i=>i.style.opacity="0.05");Mt=requestAnimationFrame(ge)}async function ye(n){if(!et)try{z&&(await z.close(),z=null),z=new(window.AudioContext||window.webkitAudioContext);const e={audio:n?{deviceId:{exact:n}}:!0},t=await navigator.mediaDevices.getUserMedia(e);wt=z.createMediaStreamSource(t),Y=z.createAnalyser(),Y.fftSize=2048,wt.connect(Y),ve=Lt.forFloat32Array(Y.fftSize),et=!0,r.tuner.display.classList.add("active"),r.indicators.tunerIndicator.classList.add("indicated"),ge()}catch(e){console.error("Could not start tuner:",e)}}function Ie(){et&&(et=!1,r.tuner.display.classList.remove("active"),r.indicators.tunerIndicator.classList.remove("indicated"),Mt&&(cancelAnimationFrame(Mt),Mt=null),wt&&(wt.disconnect(),wt=null),Y&&(Y.disconnect(),Y=null),z&&(z.close(),z=null),r.tuner.note.innerHTML='-<span class="invisible-tuner-sharp">♯</span>-')}r.tuner.display.addEventListener("click",()=>{et?Ie():ye()});const v=new Audio;function be(n){const e=Math.floor(n/60),t=Math.floor(n%60),s=Math.floor(n%1*100);return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}.${s.toString().padStart(2,"0")}`}function nt(){const n=v.currentTime/v.duration||0;r.progress.progressFill.style.width=`${n*100}%`,r.playTime.currentTimeDisplay.textContent=be(v.currentTime),!v.paused&&!v.ended&&requestAnimationFrame(nt)}let J,Tt,ce;async function rn(){J=new AudioContext;const n=new URL("data:text/javascript;base64,aW1wb3J0IHsgU291bmRUb3VjaCB9IGZyb20gInNvdW5kdG91Y2hqcyI7DQoNCmNsYXNzIFNvdW5kVG91Y2hXb3JrbGV0IGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsNCiAgc3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpIHsNCiAgICByZXR1cm4gWw0KICAgICAgeyBuYW1lOiAicmF0ZSIsIGRlZmF1bHRWYWx1ZTogMS4wLCBtaW5WYWx1ZTogMC4yNSwgbWF4VmFsdWU6IDQuMCB9LA0KICAgICAgeyBuYW1lOiAidGVtcG8iLCBkZWZhdWx0VmFsdWU6IDEuMCwgbWluVmFsdWU6IDAuMjUsIG1heFZhbHVlOiA0LjAgfSwNCiAgICAgIHsgbmFtZTogInBpdGNoIiwgZGVmYXVsdFZhbHVlOiAxLjAsIG1pblZhbHVlOiAwLjI1LCBtYXhWYWx1ZTogNC4wIH0sDQogICAgICB7IG5hbWU6ICJwaXRjaFNlbWl0b25lcyIsIGRlZmF1bHRWYWx1ZTogMCwgbWluVmFsdWU6IC0yNCwgbWF4VmFsdWU6IDI0IH0sDQogICAgXTsNCiAgfQ0KICBjb25zdHJ1Y3RvcigpIHsNCiAgICBzdXBlcigpOw0KICAgIHRoaXMuYnVmZmVyU2l6ZSA9IDQwOTY7DQogICAgdGhpcy5fc2FtcGxlcyA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5idWZmZXJTaXplICogMik7DQogICAgdGhpcy5fcGlwZSA9IG5ldyBTb3VuZFRvdWNoKCk7DQogIH0NCg0KICBwcm9jZXNzKGlucHV0cywgb3V0cHV0cywgcGFyYW1ldGVycykgew0KICAgIGlmICghaW5wdXRzWzBdLmxlbmd0aCkgcmV0dXJuIHRydWU7DQoNCiAgICBjb25zdCBsZWZ0SW5wdXQgPSBpbnB1dHNbMF1bMF07DQogICAgY29uc3QgcmlnaHRJbnB1dCA9IGlucHV0c1swXS5sZW5ndGggPiAxID8gaW5wdXRzWzBdWzFdIDogaW5wdXRzWzBdWzBdOw0KDQogICAgY29uc3QgbGVmdE91dHB1dCA9IG91dHB1dHNbMF1bMF07DQogICAgY29uc3QgcmlnaHRPdXRwdXQgPSBvdXRwdXRzWzBdLmxlbmd0aCA+IDEgPyBvdXRwdXRzWzBdWzFdIDogb3V0cHV0c1swXVswXTsNCiAgICBjb25zdCBzYW1wbGVzID0gdGhpcy5fc2FtcGxlczsNCg0KICAgIGlmICghbGVmdE91dHB1dCB8fCAhbGVmdE91dHB1dC5sZW5ndGgpIHJldHVybiBmYWxzZTsNCg0KICAgIGNvbnN0IHJhdGUgPSBwYXJhbWV0ZXJzLnJhdGVbMF0gPz8gcGFyYW1ldGVycy5yYXRlOw0KICAgIGNvbnN0IHRlbXBvID0gcGFyYW1ldGVycy50ZW1wb1swXSA/PyBwYXJhbWV0ZXJzLnRlbXBvOw0KICAgIGNvbnN0IHBpdGNoID0gcGFyYW1ldGVycy5waXRjaFswXSA/PyBwYXJhbWV0ZXJzLnBpdGNoOw0KICAgIGNvbnN0IHBpdGNoU2VtaXRvbmVzID0NCiAgICAgIHBhcmFtZXRlcnMucGl0Y2hTZW1pdG9uZXNbMF0gPz8gcGFyYW1ldGVycy5waXRjaFNlbWl0b25lczsNCg0KICAgIHRoaXMuX3BpcGUucmF0ZSA9IHJhdGU7DQogICAgdGhpcy5fcGlwZS50ZW1wbyA9IHRlbXBvOw0KICAgIHRoaXMuX3BpcGUucGl0Y2ggPSBwaXRjaCAqIE1hdGgucG93KDIsIHBpdGNoU2VtaXRvbmVzIC8gMTIpOw0KDQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZWZ0SW5wdXQubGVuZ3RoOyBpKyspIHsNCiAgICAgIHNhbXBsZXNbaSAqIDJdID0gbGVmdElucHV0W2ldOw0KICAgICAgc2FtcGxlc1tpICogMiArIDFdID0gcmlnaHRJbnB1dFtpXTsNCiAgICB9DQoNCiAgICB0aGlzLl9waXBlLmlucHV0QnVmZmVyLnB1dFNhbXBsZXMoc2FtcGxlcywgMCwgbGVmdElucHV0Lmxlbmd0aCk7DQoNCiAgICB0aGlzLl9waXBlLnByb2Nlc3MoKTsNCg0KICAgIGNvbnN0IHByb2Nlc3NlZFNhbXBsZXMgPSBuZXcgRmxvYXQzMkFycmF5KGxlZnRJbnB1dC5sZW5ndGggKiAyKTsNCiAgICB0aGlzLl9waXBlLm91dHB1dEJ1ZmZlci5yZWNlaXZlU2FtcGxlcyhwcm9jZXNzZWRTYW1wbGVzLCBsZWZ0T3V0cHV0Lmxlbmd0aCk7DQoNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlZnRJbnB1dC5sZW5ndGg7IGkrKykgew0KICAgICAgbGVmdE91dHB1dFtpXSA9IHByb2Nlc3NlZFNhbXBsZXNbaSAqIDJdOw0KICAgICAgcmlnaHRPdXRwdXRbaV0gPSBwcm9jZXNzZWRTYW1wbGVzW2kgKiAyICsgMV07DQoNCiAgICAgIGlmIChpc05hTihsZWZ0T3V0cHV0W2ldKSB8fCBpc05hTihyaWdodE91dHB1dFtpXSkpIHsNCiAgICAgICAgbGVmdE91dHB1dFtpXSA9IDA7DQogICAgICAgIHJpZ2h0T3V0cHV0W2ldID0gMDsNCiAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KfQ0KDQpyZWdpc3RlclByb2Nlc3Nvcigic291bmR0b3VjaC1wcm9jZXNzb3IiLCBTb3VuZFRvdWNoV29ya2xldCk7DQo=",import.meta.url);await J.audioWorklet.addModule(n.href),Tt=new AudioWorkletNode(J,"soundtouch-processor"),Tt.parameters.get("pitchSemitones"),ce=J.createMediaElementSource(v),ce.connect(Tt).connect(J.destination)}function Be(){return J}function Ce(){return J}function ln(){return Tt}rn();const $={player:75,metro:50,fork:25};let O=null;function cn(n){const e=Be();O||(O=e.createGain(),O.gain.value=$.fork/100,O.connect(e.destination)),n.connect(O)}function Yt(n){v.volume=n/100}function Pt(n){R?.setVolume&&R.setVolume(n/100)}function qt(n){O&&(O.gain.value=n/100)}function dn(){const n=document.getElementById("player-vol"),e=document.getElementById("metro-vol"),t=document.getElementById("fork-vol");n&&(n.addEventListener("input",s=>Yt(s.target.value)),n.addEventListener("dblclick",()=>{n.value=$.player,Yt($.player)}),Yt(n.value)),e&&(e.addEventListener("input",s=>Pt(s.target.value)),e.addEventListener("dblclick",()=>{e.value=$.metro,Pt($.metro)}),Pt(e.value)),t&&(t.addEventListener("input",s=>qt(s.target.value)),t.addEventListener("dblclick",()=>{t.value=$.fork,qt($.fork)}),qt(t.value))}dn();const un=440,Le=["A","A♯","B","C","C♯","D","D♯","E","F","F♯","G","G♯"];let j=12,_t=null,x=null;function se(n){const e=Le[n%12],t=Math.floor(n/12)+3,s=n-12,o=un*Math.pow(2,s/12);return{noteName:e,octave:t,freq:o}}function we(n){const{noteName:e,octave:t,freq:s}=se(n),o=e.includes("♯");r.fork.placeholder.innerHTML='~<span class="fork-sharp">♯</span>~',r.fork.note.innerHTML=e[0]+'<span class="fork-sharp">'+(o?"♯":'<span class="invisible-fork-sharp">♯</span>')+"</span>"+t,r.fork.note.dataset.hasSharp=o,r.fork.freq.textContent=s.toFixed(3)+" Hz"}function mn(n){_t=Be(),Ee(),x=_t.createOscillator(),x.type="sine",x.frequency.setValueAtTime(n,_t.currentTime),cn(x),x.start(),r.fork.display.classList.add("active"),r.indicators.forkIndicator.classList.add("indicated")}function Ee(){x&&(x.stop(),x.disconnect(),x=null),r.fork.display.classList.remove("active"),r.indicators.forkIndicator.classList.remove("indicated")}r.fork.display.addEventListener("click",()=>{if(x)Ee();else{const{freq:n}=se(j);mn(n)}});r.fork.display.addEventListener("wheel",n=>{if(n.preventDefault(),j+=n.deltaY<0?1:-1,j=Math.max(0,Math.min(Le.length*3-1,j)),we(j),x){const{freq:e}=se(j);x.frequency.setValueAtTime(e,_t.currentTime)}});we(j);r.pitchControls.tempoWheel.addEventListener("click",()=>{let n=0;const e=8,t=150/e,s=setInterval(()=>{r.pitchControls.tempoWheel.classList.toggle("active"),n++,n>=e&&(clearInterval(s),r.pitchControls.tempoWheel.classList.remove("active"))},t)});let Et=!1;function xt(n,e,t){return Math.max(e,Math.min(t,n))}function P(n){const e=r.loopInputs[n],t=parseInt(e.mins.value)||0,s=parseInt(e.secs.value)||0,o=parseInt(e.hund.value)||0;return t*60+s+o/100}function ut(){const n=v;if(!n||!n.duration)return;const t=r.progress.seekBar.clientWidth,s=P("start"),o=P("end"),a=Math.min(Math.max(s/n.duration,0),1),l=Math.min(Math.max(o/n.duration,0),1),i=2;r.loopMarkers.loopStartMarker.style.left=`${a*t-i}px`;const d=t-l*t-i;r.loopMarkers.loopEndMarker.style.right=`${d}px`}function Kt(){if(!Et)return;const n=v;if(!n||n.paused||!n.duration){requestAnimationFrame(Kt);return}let e=P("start"),t=P("end");t-e<1&&(t=e+1,t>n.duration&&(t=n.duration,e=Math.max(0,t-1)),["start","end"].forEach(s=>{const o=r.loopInputs[s],a=s==="start"?e:t,l=Math.floor(a/60),i=Math.floor(a%60),d=Math.floor((a-Math.floor(a))*100);o.mins.value=String(l).padStart(2,"0"),o.secs.value=String(i).padStart(2,"0"),o.hund.value=String(d).padStart(2,"0")})),n.currentTime>=t&&(n.currentTime=e),ut(),requestAnimationFrame(Kt)}function pn(){Et?(r.loopDisp.loopStartDisp.classList.add("active"),r.loopDisp.loopEndDisp.classList.add("active"),r.controls.loopButton.classList.add("active"),r.indicators.loopIndicator.classList.add("indicated")):(r.loopDisp.loopStartDisp.classList.remove("active"),r.loopDisp.loopEndDisp.classList.remove("active"),r.controls.loopButton.classList.remove("active"),r.indicators.loopIndicator.classList.remove("indicated"))}r.controls.loopButton.addEventListener("click",()=>{Et=!Et,pn(),Et&&requestAnimationFrame(Kt)});r.controls.gotoLoopStart.addEventListener("click",()=>{const n=P("start");v&&v.duration&&(v.currentTime=Math.min(n,v.duration),nt())});function hn(n,e,t){const s=r.loopInputs[n];let o=parseInt(s.mins.value)||0,a=parseInt(s.secs.value)||0,l=parseInt(s.hund.value)||0,i=(o*60+a)*100+l;e==="mins"&&(i+=t*6e3),e==="secs"&&(i+=t*100),e==="hund"&&(i+=t);const d=Math.floor((v?.duration||0)*100);if(n==="start"){const f=Math.floor(P("end")*100);i=xt(i,0,f-100)}else{const f=Math.floor(P("start")*100);i=xt(i,f+100,d)}o=Math.floor(i/6e3),a=Math.floor(i%6e3/100),l=i%100,s.mins.value=String(o).padStart(2,"0"),s.secs.value=String(a).padStart(2,"0"),s.hund.value=String(l).padStart(2,"0")}function de(){const n=Math.floor((v?.duration||0)*100);["start","end"].forEach(e=>{const t=r.loopInputs[e];let s=parseInt(t.mins.value)||0,o=parseInt(t.secs.value)||0,a=parseInt(t.hund.value)||0,l=(s*60+o)*100+a;if(e==="start"){const i=Math.floor(P("end")*100);l=xt(l,0,i-100)}else{const i=Math.floor(P("start")*100);l=xt(l,i+100,n)}s=Math.floor(l/6e3),o=Math.floor(l%6e3/100),a=l%100,t.mins.value=String(s).padStart(2,"0"),t.secs.value=String(o).padStart(2,"0"),t.hund.value=String(a).padStart(2,"0")})}window.addEventListener("resize",ut);function fn(){["start","end"].forEach(n=>{["mins","secs","hund"].forEach(e=>{r.loopInputs[n][e].addEventListener("wheel",t=>{t.preventDefault();const s=t.deltaY<0?1:-1;hn(n,e,s),ut()})})})}fn();function vn(){const n=document.querySelectorAll(".time-part"),e=new Map;n.forEach(t=>{e.set(t,""),t.addEventListener("focus",()=>{t.classList.add("focused"),t.select()}),t.addEventListener("blur",()=>{t.classList.remove("focused");let s=e.get(t);s.length===1&&(s="0"+s),s.length===0&&(s="00");const o=t.value;t.value=s,e.set(t,""),t.value!==o&&(de(),ut())}),t.addEventListener("keydown",s=>{if(s.key>="0"&&s.key<="9"){s.preventDefault();let o=e.get(t);if(o=(o+s.key).slice(-2),e.set(t,o),t.value=o.padStart(2,"0"),o.length===2){de(),ut();const a=Array.from(n),l=a.indexOf(t);l>=0&&l<a.length-1?a[l+1].focus():t.blur()}}else s.key==="Backspace"&&(s.preventDefault(),e.set(t,""),t.value="00")})})}vn();function ue(n){const e=Math.floor(n/60),t=Math.floor(n%60),s=Math.floor((n-Math.floor(n))*100);r.loopInputs.start.mins.value="00",r.loopInputs.start.secs.value="00",r.loopInputs.start.hund.value="00",r.loopInputs.end.mins.value=String(e).padStart(2,"0"),r.loopInputs.end.secs.value=String(t).padStart(2,"0"),r.loopInputs.end.hund.value=String(s).padStart(2,"0"),ut()}function mt(){const n=S||0,e=M/100||0,t=n+e,s=ln();s&&s.parameters.get("pitchSemitones").setValueAtTime(t,Ce().currentTime)}function pt(){S!==0?r.pitchControls.transposeWheel.classList.add("active"):r.pitchControls.transposeWheel.classList.remove("active"),M!==0?r.pitchControls.tuneWheel.classList.add("active"):r.pitchControls.tuneWheel.classList.remove("active"),S!==0||M!==0?r.indicators.pitchIndicator.classList.add("indicated"):r.indicators.pitchIndicator.classList.remove("indicated")}let S=0;r.pitchControls.transposeWheel.addEventListener("wheel",n=>{n.preventDefault(),n.deltaY<0?S+=1:S-=1,S=Math.max(-5,Math.min(5,S)),r.pitchControls.transposeValue.textContent=Math.abs(S),r.pitchControls.transposeSign.classList.remove("active-plus","active-minus"),S>0?r.pitchControls.transposeSign.classList.add("active-plus"):S<0&&r.pitchControls.transposeSign.classList.add("active-minus"),mt(),pt()});let M=0;r.pitchControls.tuneWheel.addEventListener("wheel",n=>{n.preventDefault(),M+=n.deltaY<0?1:-1,M=Math.max(-99,Math.min(99,M));const e=Math.abs(M);r.pitchControls.tuneValue.innerHTML=e<10?`<span class="invisible-zero">0</span>${e}`:String(e),r.pitchControls.tuneSign.classList.remove("active-plus","active-minus"),M>0?r.pitchControls.tuneSign.classList.add("active-plus"):M<0&&r.pitchControls.tuneSign.classList.add("active-minus"),mt(),pt()});r.pitchControls.transposeWheel.addEventListener("dblclick",()=>{S=0,r.pitchControls.transposeValue.textContent="0",r.pitchControls.transposeSign.classList.remove("active-plus","active-minus"),mt(),pt()});r.pitchControls.tuneWheel.addEventListener("dblclick",()=>{M=0,r.pitchControls.tuneValue.textContent="00",r.pitchControls.tuneSign.classList.remove("active-plus","active-minus"),mt(),pt()});function Ae({wheelEl:n,onChange:e,clampMin:t,clampMax:s,getValue:o,setValue:a,sensitivity:l=.1,resetValue:i=0}){let d=null,f=0,h=0;const g=300,E=()=>{d=null,f=0};n.addEventListener("touchstart",b=>{if(b.touches.length!==1)return;const w=Date.now();if(w-h<g){a(i),e(),b.preventDefault();return}h=w,d=b.touches[0].clientY,f=0},{passive:!1}),n.addEventListener("touchmove",b=>{if(b.touches.length!==1||d===null)return;const w=b.touches[0].clientY,B=d-w;f+=B,d=w;const I=f*l;if(Math.abs(I)>=1){let C=Math.round(o()+I);C=Math.max(t,Math.min(s,C)),a(C),e(),f=0}b.preventDefault()},{passive:!1}),n.addEventListener("touchend",E)}Ae({wheelEl:r.pitchControls.transposeWheel,sensitivity:.02,clampMin:-5,clampMax:5,resetValue:0,getValue:()=>S,setValue:n=>{S=n},onChange:()=>{r.pitchControls.transposeValue.textContent=Math.abs(S),r.pitchControls.transposeSign.classList.remove("active-plus","active-minus"),S>0?r.pitchControls.transposeSign.classList.add("active-plus"):S<0&&r.pitchControls.transposeSign.classList.add("active-minus"),mt(),pt()}});Ae({wheelEl:r.pitchControls.tuneWheel,sensitivity:.05,clampMin:-99,clampMax:99,resetValue:0,getValue:()=>M,setValue:n=>{M=n},onChange:()=>{const n=Math.abs(M);r.pitchControls.tuneValue.innerHTML=n<10?`<span class="invisible-zero">0</span>${n}`:String(n),r.pitchControls.tuneSign.classList.remove("active-plus","active-minus"),M>0?r.pitchControls.tuneSign.classList.add("active-plus"):M<0&&r.pitchControls.tuneSign.classList.add("active-minus"),mt(),pt()}});r.controls.uploadButton.addEventListener("click",()=>{r.controls.fileInput.click()});r.fileStatus.fileName.textContent="No file selected.";r.fileStatus.fileName.classList.add("blinkingSlow");r.controls.fileInput.addEventListener("change",async()=>{ue(v.duration),r.controls.playButton.disabled=!1,r.controls.pauseButton.disabled=!1,r.controls.stopButton.disabled=!1,r.controls.gotoLoopStart.disabled=!1,r.controls.loopButton.disabled=!1;const n=r.controls.fileInput.files[0],e=r.fileStatus.fileName;if(!n){e.textContent="No file selected.",e.removeAttribute("title");return}e.textContent="Loading...",e.classList.add("blinkingFast"),r.fileStatus.fileDuration.textContent="(--:--.--)",await new Promise(a=>setTimeout(a,500)),await new Promise(requestAnimationFrame);const t=URL.createObjectURL(n);v.src=t,v.load(),r.fileStatus.fileDuration.textContent="(--:--.--)",r.playTime.currentTimeDisplay.textContent="00:00.00",e.classList.remove("blinkingSlow"),r.controls.playButton.classList.remove("active"),r.controls.pauseButton.classList.remove("active"),r.controls.stopButton.classList.remove("active");let s=!1;const o=setTimeout(()=>{s||(e.textContent="Failed to load file.",e.classList.remove("blinkingFast"),r.playTime.currentTimeDisplay.textContent="ER:RO.R0",setTimeout(()=>{e.textContent="No file selected.",r.playTime.currentTimeDisplay.textContent="00:00.00",e.classList.add("blinkingSlow"),e.removeAttribute("title")},3e3))},2e3);v.addEventListener("loadedmetadata",()=>{s=!0,clearTimeout(o),e.textContent=n.name,e.title=n.name,r.fileStatus.fileDuration.textContent=`(${be(v.duration)})`,ue(v.duration),e.classList.remove("blinkingFast"),r.controls.playButton.disabled=!1,r.controls.pauseButton.disabled=!1,r.controls.stopButton.disabled=!1,r.controls.gotoLoopStart.disabled=!1,r.controls.loopButton.disabled=!1},{once:!0})});r.controls.playButton.disabled=!0;r.controls.pauseButton.disabled=!0;r.controls.stopButton.disabled=!0;r.controls.playButton.addEventListener("click",()=>{v.src&&(Ce().resume(),v.play()),requestAnimationFrame(nt),r.controls.playButton.classList.add("active"),r.controls.pauseButton.classList.remove("active"),r.controls.stopButton.classList.remove("active"),r.indicators.playIndicator.classList.add("indicated"),r.indicators.pauseIndicator.classList.remove("indicated")});r.controls.pauseButton.addEventListener("click",()=>{v.pause(),requestAnimationFrame(nt),r.controls.pauseButton.classList.add("active"),r.controls.playButton.classList.remove("active"),r.controls.stopButton.classList.remove("active"),r.indicators.pauseIndicator.classList.add("indicated"),r.indicators.playIndicator.classList.remove("indicated")});r.controls.stopButton.addEventListener("click",()=>{v.pause(),v.currentTime=0,requestAnimationFrame(nt),r.controls.stopButton.classList.add("active"),setTimeout(()=>{r.controls.stopButton.classList.remove("active")},1e3),r.controls.playButton.classList.remove("active"),r.controls.pauseButton.classList.remove("active"),r.indicators.playIndicator.classList.remove("indicated"),r.indicators.pauseIndicator.classList.remove("indicated")});r.progress.seekBar.addEventListener("click",n=>{const e=r.progress.seekBar.getBoundingClientRect(),t=n.clientX-e.left,s=e.width,o=t/s;v.duration&&(v.currentTime=o*v.duration,nt())});v.addEventListener("ended",()=>{v.pause(),v.currentTime=0,nt(),r.controls.playButton.classList.remove("active"),r.controls.pauseButton.classList.remove("active"),r.controls.stopButton.classList.remove("active"),r.indicators.playIndicator.classList.remove("indicated"),r.indicators.pauseIndicator.classList.remove("indicated"),r.playTime.currentTimeDisplay.textContent="00:00.00"});document.addEventListener("DOMContentLoaded",()=>{const n={NOTE:"ss_notepad",IMAGE:"ss_image",PDF:"ss_pdf",YT_URL:"ss_yt_url"};let e=localStorage.getItem(n.NOTE)||"",t=localStorage.getItem(n.IMAGE)||null,s=localStorage.getItem(n.PDF)||null,o={url:localStorage.getItem(n.YT_URL)||"",iframe:null};const a=[...document.querySelectorAll("header menu button")],l=document.getElementById("viewer-content"),i=()=>a.forEach(c=>c.classList.remove("active")),d=c=>{const u=document.createElement("div");return u.id=c,u.className="tab-pane",l.appendChild(u),u},f={PDF:d("tab-pdf"),Image:d("tab-image"),Notepad:d("tab-notepad"),YouTube:d("tab-yt")},h=c=>{for(const[u,m]of Object.entries(f))m.classList.toggle("active",u===c)},g=(c,u,m)=>{c.className="tab-pane viewer-drop-zone",c.innerHTML="<p>Drop a file here</p>",c.ondragover=p=>{p.preventDefault(),c.classList.add("drag-over")},c.ondragleave=()=>c.classList.remove("drag-over"),c.ondrop=p=>{p.preventDefault(),c.classList.remove("drag-over");const y=p.dataTransfer.files[0];y&&u(y)?m(y):c.innerHTML="<p>Unsupported file.</p>"}};function E(){const c=f.PDF;if(c.dataset.loaded){h("PDF");return}const u=m=>c.innerHTML=`<embed src="${m}" type="application/pdf">`;s?(c.className="tab-pane",fetch(s,{method:"HEAD"}).then(m=>m.ok?u(s):Promise.reject()).catch(()=>c.innerHTML="<p>File not found!</p>")):g(c,m=>m.type==="application/pdf",m=>{const p=new FileReader;p.onload=()=>{s=p.result,localStorage.setItem(n.PDF,s),u(s)},p.readAsDataURL(m)}),c.dataset.loaded="true",h("PDF")}function b(c){const u=c.parentElement;u.style.cssText="overflow:hidden;position:relative;cursor:grab;",c.style.cssText="position:absolute;left:0;top:0;transform-origin:0 0;user-select:none;";let m=1,p=0,y=0;const _=()=>{const L=c.naturalWidth*m,D=c.naturalHeight*m,W=Math.min(0,u.clientWidth-L),F=Math.min(0,u.clientHeight-D);p=Math.max(W,Math.min(0,p)),y=Math.max(F,Math.min(0,y)),L<u.clientWidth&&(p=(u.clientWidth-L)/2),D<u.clientHeight&&(y=(u.clientHeight-D)/2)},T=()=>{_(),c.style.transform=`translate(${p}px,${y}px) scale(${m})`};c.onload=()=>{m=1,p=y=0,T()},c.complete&&c.onload(),u.addEventListener("wheel",L=>{L.preventDefault();const{left:D,top:W}=u.getBoundingClientRect(),F=L.clientX-D,X=L.clientY-W,Q=L.deltaY<0?1.1:.9,q=Math.min(Math.max(m*Q,.1),10);if(q===m)return;const U=(F-p)/m,K=(X-y)/m;m=q,p=F-U*m,y=X-K*m,c.style.transition="transform 0.25s ease",T(),clearTimeout(u._t),u._t=setTimeout(()=>c.style.transition="none",250)},{passive:!1});let k=!1,V=0,G=0;u.addEventListener("mousedown",L=>{k=!0,V=L.clientX,G=L.clientY,u.style.cursor="grabbing",c.style.transition="none"}),document.addEventListener("mouseup",()=>{k=!1,u.style.cursor="grab"}),document.addEventListener("mousemove",L=>{k&&(p+=L.clientX-V,y+=L.clientY-G,V=L.clientX,G=L.clientY,T())})}function w(){const c=f.Image;if(c.dataset.loaded){h("Image");return}const u=m=>{c.className="tab-pane",c.innerHTML="";const p=new Image;p.onload=()=>b(p),p.onerror=()=>c.innerHTML="<p>File not found!</p>",p.src=m,c.appendChild(p)};t?u(t):g(c,m=>m.type.startsWith("image/"),m=>{const p=new FileReader;p.onload=()=>{t=p.result,localStorage.setItem(n.IMAGE,t),c.dataset.loaded="",u(t),h("Image")},p.readAsDataURL(m)}),c.dataset.loaded="true",h("Image")}function B(){const c=f.Notepad;if(c.dataset.loaded){h("Notepad");return}c.className="tab-pane",c.innerHTML=`<textarea id="notepad" placeholder="Start typing…">${e}</textarea>`;const u=c.querySelector("#notepad");let m;u.addEventListener("input",()=>{clearTimeout(m),m=setTimeout(()=>localStorage.setItem(n.NOTE,u.value),2e3)}),c.dataset.loaded="true",h("Notepad")}function I(){const c=f.YouTube;if(c.dataset.loaded){h("YouTube");return}c.innerHTML=`
      <input id="yt-url" type="url" autocomplete="off"
             placeholder="Paste YouTube URL and press Enter" value="${o.url}">
      <div id="yt-frame" class="yt-frame">${o.iframe||""}</div>`;const u=c.querySelector("#yt-url"),m=c.querySelector("#yt-frame"),p=y=>{const _=y.match(/[?&]v=([^&]+)/)||y.match(/youtu\.be\/([^?]+)/);if(!_){m.innerHTML="<p>Invalid URL.</p>";return}const T=_[1];o={url:y,iframe:`<iframe src="https://www.youtube.com/embed/${T}" allowfullscreen></iframe>`},localStorage.setItem(n.YT_URL,o.url),m.innerHTML=o.iframe};o.url&&p(o.url),u.addEventListener("keydown",y=>{y.key==="Enter"&&p(u.value.trim())}),c.dataset.loaded="true",h("YouTube")}const C={PDF:E,Image:w,Notepad:B,YouTube:I};a.forEach(c=>{const u=c.textContent.trim();u!=="Clear tab"&&c.addEventListener("click",()=>{i(),c.classList.add("active"),C[u]?.()})}),document.getElementById("clear-tab").addEventListener("click",()=>{const c=Object.entries(f).find(([m,p])=>p.classList.contains("active"))?.[0];if(!c)return;const u=f[c];switch(c){case"Notepad":{const m=u.querySelector("textarea");m&&(m.value=""),localStorage.removeItem(n.NOTE),e="",u.dataset.loaded="";break}case"Image":{u.innerHTML="",localStorage.removeItem(n.IMAGE),t=null,u.dataset.loaded="";break}case"PDF":{u.innerHTML="",localStorage.removeItem(n.PDF),s=null,u.dataset.loaded="";break}case"YouTube":{u.innerHTML="",localStorage.removeItem(n.YT_URL),o={url:"",iframe:null},u.dataset.loaded="";break}}C[c]?.()}),a[0].click()});r.viewer.focusBtn.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(n=>{console.error(`Error attempting to enable fullscreen: ${n.message}`)})});
